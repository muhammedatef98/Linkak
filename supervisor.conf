# Supervisor Configuration for Linkak

[supervisord]
nodaemon=true
user=root
logfile=/app/logs/supervisord.log
pidfile=/var/run/supervisord.pid

[unix_http_server]
file=/var/run/supervisor.sock
chmod=0700

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

# Main Linkak Application
[program:linkak]
command=gunicorn --config /app/deploy/gunicorn.conf.py src.main:app
directory=/app
user=linkak
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/app/logs/linkak.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=10
environment=FLASK_ENV=production

# Nginx Web Server
[program:nginx]
command=nginx -g "daemon off;"
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/app/logs/nginx_supervisor.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=5

# Background Tasks Worker (Celery - optional)
[program:celery_worker]
command=celery -A src.main.celery worker --loglevel=info
directory=/app
user=linkak
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/app/logs/celery_worker.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=5
environment=FLASK_ENV=production

# Celery Beat Scheduler (for scheduled tasks)
[program:celery_beat]
command=celery -A src.main.celery beat --loglevel=info
directory=/app
user=linkak
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/app/logs/celery_beat.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=5
environment=FLASK_ENV=production

# Backup Service
[program:backup_service]
command=python /app/scripts/backup_scheduler.py
directory=/app
user=linkak
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/app/logs/backup.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=5
environment=FLASK_ENV=production

# Log Rotation Service
[program:logrotate]
command=/app/scripts/log_rotator.sh
directory=/app
user=linkak
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/app/logs/logrotate.log

# Health Check Monitor
[program:health_monitor]
command=python /app/scripts/health_monitor.py
directory=/app
user=linkak
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/app/logs/health_monitor.log